package nextstep.qna.service;import java.util.List;import javax.annotation.Resource;import nextstep.qna.CannotDeleteException;import nextstep.qna.NotFoundException;import nextstep.qna.domain.*;import nextstep.users.domain.NsUser;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;@Service("qnaService")public class QnAService {    @Resource(name = "questionRepository")    private QuestionRepository questionRepository;        @Resource(name = "answerRepository")    private AnswerRepository answerRepository;        @Resource(name = "deleteHistoryService")    private DeleteHistoryService deleteHistoryService;        @Transactional    public void deleteQuestion(NsUser loginUser, long questionId) throws CannotDeleteException {        Question question = questionRepository.findById(questionId).orElseThrow(NotFoundException::new);        question.isHaveAuthority(loginUser);                Answers answers = question.sameUserQuestionAndAnswer();                deleteHistoryService.saveAll(new DeleteHistories(deleteQuestion(question), deleteAnswers(answers)).toList());    }        private DeleteHistory deleteQuestion(Question question) {        question.delete();        if(question.isDeleted()) {            return question.addInDeleteHistory();        }        return new DeleteHistory();    }        private List<DeleteHistory> deleteAnswers(Answers answers) {        answers.deleteAll();        if(answers.isAllDelete()) {            return answers.addInDeleteHistory();        }        return List.of();    }}